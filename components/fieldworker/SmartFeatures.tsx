"use client";

import { useState, useRef } from "react";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";
import { Mic, MicOff, Camera, MapPin, Star, QrCode } from "lucide-react";

interface SmartFeaturesProps {
  onVoiceText: (text: string) => void;
  onPhotoCapture: (photo: string) => void;
  onFeedback: (rating: number) => void;
}

export default function SmartFeatures({ onVoiceText, onPhotoCapture, onFeedback }: SmartFeaturesProps) {
  const [isRecording, setIsRecording] = useState(false);
  const [voiceText, setVoiceText] = useState("");
  const [citizenRating, setCitizenRating] = useState(0);
  const [showFeedback, setShowFeedback] = useState(false);
  const fileInputRef = useRef<HTMLInputElement>(null);

  const startVoiceRecording = () => {
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {\n      const SpeechRecognition = (window as any).webkitSpeechRecognition || (window as any).SpeechRecognition;\n      const recognition = new SpeechRecognition();\n      \n      recognition.continuous = true;\n      recognition.interimResults = true;\n      recognition.lang = 'en-IN';\n      \n      recognition.onstart = () => {\n        setIsRecording(true);\n      };\n      \n      recognition.onresult = (event: any) => {\n        let finalTranscript = '';\n        for (let i = event.resultIndex; i < event.results.length; i++) {\n          if (event.results[i].isFinal) {\n            finalTranscript += event.results[i][0].transcript;\n          }\n        }\n        if (finalTranscript) {\n          setVoiceText(finalTranscript);\n          onVoiceText(finalTranscript);\n        }\n      };\n      \n      recognition.onerror = () => {\n        setIsRecording(false);\n        alert('Voice recognition error. Please try again.');\n      };\n      \n      recognition.onend = () => {\n        setIsRecording(false);\n      };\n      \n      recognition.start();\n    } else {\n      alert('Voice recognition not supported in this browser');\n    }\n  };

  const stopVoiceRecording = () => {\n    setIsRecording(false);\n  };

  const handleBeforeAfterPhoto = () => {\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.accept = 'image/*';\n    input.capture = 'environment';\n    input.onchange = (e) => {\n      const file = (e.target as HTMLInputElement).files?.[0];\n      if (file) {\n        const reader = new FileReader();\n        reader.onload = (event) => {\n          const photo = event.target?.result as string;\n          onPhotoCapture(photo);\n          alert('Photo captured for before/after comparison');\n        };\n        reader.readAsDataURL(file);\n      }\n    };\n    input.click();\n  };

  const handleCitizenFeedback = (rating: number) => {\n    setCitizenRating(rating);\n    onFeedback(rating);\n    alert(`Citizen feedback recorded: ${rating}/5 stars`);\n    setShowFeedback(false);\n  };

  const handleBarcodeScan = () => {\n    // Mock barcode scanning\n    const mockBarcodes = ['EQ001-SHOVEL', 'EQ002-CEMENT', 'EQ003-TOOLS'];\n    const scanned = mockBarcodes[Math.floor(Math.random() * mockBarcodes.length)];\n    alert(`Equipment scanned: ${scanned}`);\n  };

  return (\n    <div className=\"space-y-4\">\n      {/* Voice-to-Text */}\n      <Card className=\"p-4\">\n        <h4 className=\"font-semibold mb-3 flex items-center gap-2\">\n          <Mic className=\"w-4 h-4\" />\n          Voice Description\n        </h4>\n        <div className=\"flex gap-2 mb-3\">\n          <Button \n            onClick={isRecording ? stopVoiceRecording : startVoiceRecording}\n            className={`flex-1 ${isRecording ? 'bg-red-600 hover:bg-red-700' : 'bg-blue-600 hover:bg-blue-700'}`}\n          >\n            {isRecording ? <MicOff className=\"w-4 h-4 mr-2\" /> : <Mic className=\"w-4 h-4 mr-2\" />}\n            {isRecording ? 'Stop Recording' : 'Start Voice Recording'}\n          </Button>\n        </div>\n        {voiceText && (\n          <div className=\"p-3 bg-gray-50 rounded border\">\n            <p className=\"text-sm\">{voiceText}</p>\n          </div>\n        )}\n      </Card>\n\n      {/* Before/After Photos */}\n      <Card className=\"p-4\">\n        <h4 className=\"font-semibold mb-3 flex items-center gap-2\">\n          <Camera className=\"w-4 h-4\" />\n          Resolution Proof\n        </h4>\n        <div className=\"grid grid-cols-2 gap-2\">\n          <Button onClick={handleBeforeAfterPhoto} variant=\"outline\">\n            ðŸ“· Before Photo\n          </Button>\n          <Button onClick={handleBeforeAfterPhoto} variant=\"outline\">\n            ðŸ“· After Photo\n          </Button>\n        </div>\n      </Card>\n\n      {/* Equipment Tracking */}\n      <Card className=\"p-4\">\n        <h4 className=\"font-semibold mb-3 flex items-center gap-2\">\n          <QrCode className=\"w-4 h-4\" />\n          Equipment & Materials\n        </h4>\n        <div className=\"space-y-2\">\n          <Button onClick={handleBarcodeScan} variant=\"outline\" className=\"w-full\">\n            ðŸ“± Scan Equipment Barcode\n          </Button>\n          <div className=\"grid grid-cols-2 gap-2 text-xs\">\n            <div className=\"p-2 bg-gray-50 rounded\">\n              <div className=\"font-medium\">Materials Used</div>\n              <div>Cement: 2 bags</div>\n              <div>Sand: 1 trolley</div>\n            </div>\n            <div className=\"p-2 bg-gray-50 rounded\">\n              <div className=\"font-medium\">Time Spent</div>\n              <div>Start: 9:30 AM</div>\n              <div>Duration: 2.5 hrs</div>\n            </div>\n          </div>\n        </div>\n      </Card>\n\n      {/* Citizen Feedback */}\n      <Card className=\"p-4\">\n        <h4 className=\"font-semibold mb-3 flex items-center gap-2\">\n          <Star className=\"w-4 h-4\" />\n          Citizen Satisfaction\n        </h4>\n        {!showFeedback ? (\n          <Button \n            onClick={() => setShowFeedback(true)}\n            className=\"w-full bg-green-600 hover:bg-green-700\"\n          >\n            Collect Citizen Feedback\n          </Button>\n        ) : (\n          <div className=\"space-y-3\">\n            <p className=\"text-sm\">Rate the work quality (1-5 stars):</p>\n            <div className=\"flex justify-center gap-2\">\n              {[1,2,3,4,5].map(star => (\n                <button\n                  key={star}\n                  onClick={() => handleCitizenFeedback(star)}\n                  className=\"text-2xl hover:scale-110 transition-transform\"\n                >\n                  <Star className={`w-8 h-8 ${star <= citizenRating ? 'text-yellow-500 fill-current' : 'text-gray-300'}`} />\n                </button>\n              ))}\n            </div>\n            <Button \n              onClick={() => setShowFeedback(false)}\n              variant=\"outline\" \n              className=\"w-full\"\n            >\n              Cancel\n            </Button>\n          </div>\n        )}\n      </Card>\n    </div>\n  );\n}", "oldStr": ""}]